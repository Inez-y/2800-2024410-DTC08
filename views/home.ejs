<%- include("templates/htmlDocHeader") %>
<%- include("templates/header") %>

<style>
    /* Additional styles for chat bubbles */
    .chat-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 600px;
        margin-top: 20px;
    }

    .chat-message {
        padding: 10px;
        margin: 5px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        position: relative; /* Needed for absolute positioning of the star button */
    }

    .recipt-message {
        align-self: flex-end;
        background-color: #d1f1e6;
    }

    .user-message {
        align-self: flex-start;
        background-color: #f0f0f0;
    }

    .chatlog {
        max-height: 90vh;
        overflow-y: auto;
        width: 100%;
    }

    .save-recipe-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        cursor: pointer;
        color: green; /* Color of the star */
        border: none;
        background: none;
    }
</style>


<main class="flex flex-col items-center justify-center h-screen">
    <% if (show) { %>
        <div class="flex flex-col items-center">
            <img src="/recipt_logo.png" alt="ReciPT Logo" class="w-100 h-10 mr-2">
            <p class="mt-4 text-lg text-gray-700">How can I help you today?</p>
        </div>
    <% } else { %>
        <div id="query-logs" class="chatlog chat-container m-4">
            <% for(let i=1; i < response.length; i++) { %>
                <div class="chat-message <% if (i%2==0) { %>recipt-message<% } else { %>user-message<% } %>">
                    <strong><% if (i%2==0) { %>ReciPT:<% } else { %>You:<% } %></strong>
                    <span><%= response[i].content %></span>
                    <% if (isRecipe[i]) { %>
                        <form action="/save" method="post" class="save-recipe-form">
                            <input type="hidden" name="recipe" value="<%= response[i].content %>">
                            <button type="submit" class="material-icons save-recipe-btn">star</button>
                        </form>
                    <% } %>
                </div>
            <% } %>
        </div>
    <% } %>

    <div id="chatbot-container" class="mt-6 w-full max-w-xs">
        <% if (session.loggedin) { %>
            <form action="/home" method="post">
        <% } else { %>
            <form action="/" method="post" class="bg-gray-400 text-black p-4 shadow-lg rounded">
        <% } %>
                <input type="text" id="query" name="query" class="bg-gray-400 text-black p-2 rounded">
                <button id="send-btn" type="submit" class="mt-2 bg-buttongreen hover:bg-lightGrey text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Send
                </button>
            </form>
    </div>
</main>

<%- include("templates/footer") %>

<script>
    // Ensure the chatlog scrolls to the bottom
    const chatlog = document.getElementById('query-logs');
    chatlog.scrollTop = chatlog.scrollHeight;
</script>
